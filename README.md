Reporting Obligation Database
=============================

Prerequisites
-------------
ROD runs on Java platform, and has been tested and run on Tomcat Java Servlet Container. The ROD source code is built with Maven.

Please download all of these software and install them according to the instructions found at their websites:
Java, Tomcat, Maven and GIT client.

The necessary versions are as follows:
* Java 1.5 or higher
* Maven 3.0.5 or higher
* Tomcat 5.5 or higher
* GIT 1.8.4 or higher
* MySql 5.1.71 or higher


Unit testing
------------

The unit test mechanism will install its own embedded  database and create the tables when you execute them. Note that the MySQL database will keep running afterwards. You can run individual tests with: -Dtest=DatasetImportHandlerTest
```sh
$ mvn -Denv=unittest test
```
To investigate the database afterwards you can connect to it with the mysql command line tool.

```sh
mysql -S /tmp/rod-mxj/data/mysql.sock -u USER -pPASSWORD rodtestdb
```

Configuration
-------------
Copy the *unittest.properties* to a new file *local.properties* in the application root folder and modify the properties.

For the properties which names are not self-explaining clarifications and examples are given in *unittest.properties* file.

### Automatic jobs
There are some actions in ROD that can be configured to be executed periodically by automatic jobs.

####1. Deadlines calculation
This job calculates and saves new deadlines of all Reporting Obligations or marks an obligation terminated.

####2. Deadlines daemon
Publishes an RDF-formatted list of upcoming Reporting Obligation deadlines to UNS.

####3. Extractor
Imports data from external applications. Extractor has several modes:

* **roles** - receives roles' meta-information from LDAP directory
* **deliveries** - harvests delivery information from Content Registry
* **all** - both above

####4. RDF Exporter
Generates RDF files of obligations and spatials to the folder specified in property *rdfexporter.files.dest.dir*.
The exporter has two parameters. Each of them can be applied multiple times.

* **table** : table name. Valid values *obligations* , *spatial* , *instruments*,  *issues*,  *clients*
* **identifier** : if only one record is needed the the record's ID in the DB can be given in this parameter

###Cron Configuration
The jobs are executed by using [Quartz sheduler](http://quartz-scheduler.org/). Job period and parameters are configured in *local.properties* as indicated below.

*jobname*.job.interval=*cron expression*
*jobname*.job.data=*param1=value1;param2=value2;...;paramN=valueN!param1=value11;param2=value12;...;paramN=valueNN*

Parameters specified in *jobname*.job.data are mandatory for RDF Exporter and Extractor.

**NB The cron expression is different from a regular cron!** Cron expressions for Quartz can be generated by [Quartz Cron generator](http://www.cronmaker.com/).

###Cron examples
* Deadlinecalc executes *daily* at 2:15 am

```deadlinecalc.job.interval=0 15 2 1/1 * ? *```

* Deadlines daemon executes *daily* at 3:15 am

```deadlinesdaemon.job.interval=0 15 3 1/1 * ? *```

* RDF Exporter executes *daily* at 5:15 am and exports *all* tables

```rdfexporter.job.interval=0 15 5 1/1 * ? *```

```rdfexporter.job.data=table=obligations|table=issues|table=clients|table=instruments|table=spatial```

* Extractor executes *daily* at 4:15 am and harvests data from *all* external systems

```extractor.job.interval=0 15 4 1/1 * ? *```

```extractor.job.data=mode=all```


More examples of cron expressions are available in *unittest.properties*



Installation
-------------

```sh
$ mvn -Dmaven.test.skip=true install
$ cp target/rod.war /var/lib/tomcat6/webapps/ROOT.war
```

